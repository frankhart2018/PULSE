<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>test.c - PCV</title>

    <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

    <script
      src="https://code.jquery.com/jquery-3.4.1.min.js"
      integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
      crossorigin="anonymous">
    </script>
  </head>
  <body>
    <img src="arrow.png" id="arrow" style="width: 2%; float: left; margin-top: 10px;">
    <pre class="prettyprint linenums" style="width: 50%; float: left;">
      int main(int argc, char* argv[]) {
        VM vm;
        initVM(&vm);

        if(argc == 1) {
          repl(&vm);
        } else if(argc == 2) {
          runFile(&vm, argv[1]);
        } else {
          fprintf(stderr, "Usage: pulse [path]\n");
          exit(64);
        }

        freeVM(&vm);

        return 0;
      }
    </pre>

    <button type="button" id="next" style="margin-top: 20px; float: right;">Next</button>

    <div style="float: left; margin-top: 12px; margin-left: 100px; border: 1px solid black; width: 20%;">
      <p id="explanation" style="padding: 5px 10px;">Execution starts at main - always!</p>
    </div>

    <div style="float: left; margin-top: 12px; margin-left: 100px; border: 1px solid black; width: 20%;">
      <p style="padding: 5px;"><strong>Variable explorer</strong>:</p>
      <div id="variables" style="padding: 5px 10px;"><strong>argc</strong> = 0</div>
    </div>

    <script type="text/javascript">
        function isScrolledIntoView(elem) {
          var docViewTop = $(window).scrollTop();
          var docViewBottom = docViewTop + $(window).height();

          var elemTop = $(elem).offset().top;
          var elemBottom = elemTop + $(elem).height();

          return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
        }

        var marginTop = parseInt($("#arrow").css("marginTop"));
        var loc = $(".prettyprint").html().split("\n").length - 2;
        var span = 1;
        var defaultMessage = "Empty line.";
        var defaultVariable = "";

        var lineExplanation = [
          "Execution starts at main - always!",
          "Create an instance of our Virtual Machine, checkout the entire code in <a href='vm.html' target='_blank'>vm.c</a>.",
          "Initialize the virtual machine, basically initializing the dynamic array that takes in bytecode as and processes them.",
          defaultMessage,
          "Check if there are no command line arguments. For more information on 'command line arguments', follow this link: <a href='https://www.geeksforgeeks.org/command-line-arguments-in-c-cpp/' target='_blank'>Command line arguments in C/C++</a>.",
          "Call Pulse REPL (Read Evaluate Print Loop), basically a fancy name for Pulse Shell.",
          "If there is one command line argument.",
          "Then run pulse interpreter on the pulse code file.",
          "If all the cases are incorrect.",
          "Then print the usage of pulse.",
          "Exit with error code 64 (an error code that is for user's usage).",
          defaultMessage,
          defaultMessage,
          "Free the virtual machine after execution.",
          defaultMessage,
          "Return from the C program.",
          "End of program."
        ];

        var variables = [
          "<p><strong>argc</strong> = 0</p>",
          "<p><strong>vm</strong> (intiailized instance of VM)</p>",
          "<p><strong>vm->top</strong> = -1</p> <p><strong>vm->length</strong> = 0</p>",
          defaultVariable,
          "<p>Condition <strong>true</strong></p>",
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable,
          defaultVariable
        ];

        $("#next").click(function() {
          marginTop += 15;
          span++;
          if(span == loc+2) {
            span = 1;
            marginTop = 10;
            window.scrollTo(0, marginTop);
            $("#next").css("marginTop", 20);
            $("#variables").empty();
          }
          $("#arrow").css("marginTop", marginTop);
          if(!isScrolledIntoView($("#arrow"))) {
            window.scrollTo(0, (span - 5) * 15);
            $("#next").css("marginTop", (span - 8.5) * 15);
          }
          $("#explanation").html(lineExplanation[span-1]);
          $("#variables").append(variables[span-1]);
        });
    </script>
  </body>
</html>
